name: assess-with-rag
inputs:
  connector: local_docs
  select: ["**/*.{png,jpg,jpeg}"]
steps:
  - id: describe
    mode: multimodal
    prompt: |
      inline: Review the primary image and leverage retrieved assets.
      Focus item: {{ focus }}
      Retrieved text context:
      {{ rag_context }}
    inputs:
      focus: "${chunk.source_uri}"
    output: report
    rag:
      pipeline: sample_images
      query: "${document.metadata.filename}"
      top_k_text: 2
      top_k_images: 2
      text_var: rag_context
      image_var: rag_samples
outputs:
  - save: artefacts/${run_id}/rag_report.jsonl
    from: report
    as: jsonl
