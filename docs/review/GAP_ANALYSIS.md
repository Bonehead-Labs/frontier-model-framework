# Gap Analysis

| Layer | Issue | Severity | Effort | Note |
| --- | --- | --- | --- | --- |
| Config & Auth | No single Pydantic contract for connector/provider/export schemas; `load_config` returns dicts in several paths so downstream code branches on isinstance checks. | P1 | M | Introduced `core.interfaces.models` as target schema; need to retrofit config loader to emit these types and remove ad-hoc dict handling. |
| Connectors | S3/SharePoint connectors perform SDK calls without retries/backoff or structured throttling; `S3Connector.open` returns raw botocore stream without context manager hygiene. | P0 | M | Wrap calls with jittered retry + context-aware errors; adopt new `BaseConnector` once config spec wired in. |
| Processing | `cli.process` loads entire files into memory and re-chunks per invocation; chunk IDs depend on UUIDs so artefact regeneration is non-deterministic. | P1 | L | Move processing into reusable pipeline that hashes content for IDs and streams large files; align outputs with `DocumentModel`/`ChunkModel`. |
| Inference | Azure/Bedrock adapters simulate streaming and lack provider-specific telemetry (latency, cost); no enforcement of modality vs prompt inputs. | P0 | M | Use `ModelSpec` to drive capability validation, add metrics hooks, and wire real streaming callbacks. |
| Export | Exporters accept heterogeneous payloads but share no schema awareness; `build_exporter` ignores run context and upsert semantics vary per sink. | P1 | M | Standardise on `ExportSpec` + `BaseExporter.write` signature with `RunContext`; add idempotency helpers (default key fields) per sink. |
| Prompt Registry & RAG | Prompt registry lacks content hashing enforcement and RAG pipelines do not surface concurrency or retry controls. | P2 | S | Extend registry to persist `content_hash` per version and expose pipeline concurrency/timeout via config spec. |
| Observability & DX | Logs emit deprecation warnings (utcnow) and there is no structured span context around connectors/inference for tracing. CLI verbs inconsistent prior to this patch. | P1 | M | Adopt timezone-aware timestamps, add OpenTelemetry spans, finalise CLI verbs & `--set` parity (partially addressed). |
| Testing & CI | No GH Actions pipeline previously; fixtures missing for multimodal + parquet; pytest not guaranteed in env. | P1 | S | Added CI workflow, smoke fixtures, and unit tests; follow-up to ensure pytest installed in base image. |
